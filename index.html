<html>
<head></head>
<title>Metlife Account Linking</title>
<script>
  function login(){
    console.log('login');
    var http = new XMLHttpRequest();
    var url = 'https://qa.phoenix.ead.metlife.com/edge/services/public/channel/loginInteractionServices/loginservice';
    var params = 'sysId=&serviceName=validateUser&userName=claimpnc3@ml.com&password=metlife1&newUserName=&newPassword=';
    http.open("POST", url, false);

    http.setRequestHeader('API-Version','1');
    http.setRequestHeader('Authorization','Basic Y2xhaW1wbmMzQG1sLmNvbTptZXRsaWZlMQ==');
    http.setRequestHeader('Accept','application/json');
    http.setRequestHeader('Content-Type','application/json');

    http.send(params);

    http.onreadystatechange = function() {
        if(http.readyState == 4 && http.status == 200) {
            alert('all done');
            console.log(http.responseText);
        }
    }
  }
  function newBypassLogin(){
    var url = window.location.href;
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    var pairs = {};
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
      pairs[pair[0]] = pair[1];
    }
    var userName;
    if(document.getElementById("username").value){
      userName = document.getElementById("username").value;
      userName = userName.replace(/ /g,'');
    }else{
      userName = 'testvikram';
    }
    pairs.redirect_uri = decodeURIComponent(pairs.redirect_uri);
    if(pairs.account_linking_token){
      //facebook linking
      var facebookSpecificRedirectUrl = pairs.redirect_uri + '?account_linking_token=' + pairs.account_linking_token + '&authorization_code=' + 'MY_CUSTOM_AUTHORIZATION';
      console.log(facebookSpecificRedirectUrl);
      window.location.href = facebookSpecificRedirectUrl;
    }else{
      var amazonSpecificRedirectUrl = pairs.redirect_uri + '#state=' + pairs.state + '&access_token=' + userName + '&token_type=Bearer';
      console.log(amazonSpecificRedirectUrl);
      window.location.href = amazonSpecificRedirectUrl;
    }


  }
</script>
<body style="width:100%;height:100%">
  <div style="width:70%; margin:0 auto; padding-top:10%">
    <h1 style="text-align:center">Metlife Account Linking</h1>
    <input type="text" id="username" style="margin-top: 7%; height:5%; width:100%;" placeholder="User Name"></input>
    <input type="password" id="password" style="margin-top: 7%; height:5%; width:100%;" placeholder="Password"></input>
    <button id="submit" style="margin-top: 7%; height:5%; width:100%;" onclick="newBypassLogin()">SUBMIT</button>
  </div>
</body>
